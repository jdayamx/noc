{% extends 'main.html' %}
{% block content %}
<div class="container py-3 h-100">
    <div class="card rounded-3 text-black p-4">
        <h3>Network Interfaces</h3>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Interface</th>
                            <th>Type</th>
                            <th>IP Address</th>
                            <th>Speed (Mbps)</th>
                            <th>Bytes Sent</th>
                            <th>Bytes Received</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for net in network_info %}
                        <tr>
                            <td>{{ net.interface }}</td>
                            <td>{{ net.type }}</td>
                            <td>{% for ip in net.ips %}
                                {{ ip }}<br>
                            {% endfor %}</td>
                            <td>{{ net.speed if net.speed > 0 else "Unknown" }}</td>
                            <td>{{ (net.bytes_sent / (1024**2)) | round(2) }} MB</td>
                            <td>{{ (net.bytes_received / (1024**2)) | round(2) }} MB</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

        <h3>ARP Table</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>IP Address</th>
                <th>MAC Address</th>
                <th>Interface</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in arp_table %}
            <tr>
                <td>{{ entry.ip }}</td>
                <td>{{ entry.mac }}</td>
                <td>{{ entry.interface }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Summary Network Connections</h3>
    <table class="table table-bordered" id="connections-table">
        <thead>
            <tr>
                <th>IP Address</th>
                <th>Port</th>
                <th>Connections</th>
            </tr>
        </thead>
        <tbody>
            {% for sc in summarize_connections %}
            <tr>
                <td>{{ sc.ip }}</td>
                <td>{{ sc.port }}</td>
                <td>{{ sc.connections }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <table class="table table-bordered" id="totals-table">
        <thead>
            <tr>
                <th>Port</th>
                <th>Total Connections</th>
            </tr>
        </thead>
        <tbody>
            <!-- Totals будуть додані JS -->
        </tbody>
        <tfoot>
            <tr>
                <td><strong>Grand Total</strong></td>
                <td id="grand-total"></td>
            </tr>
        </tfoot>
    </table>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const rows = document.querySelectorAll('#connections-table tbody tr');
        const portTotals = {};
        let grandTotal = 0;

        rows.forEach(row => {
            const port = row.cells[1].innerText;
            const connections = parseInt(row.cells[2].innerText, 10);

            portTotals[port] = (portTotals[port] || 0) + connections;
            grandTotal += connections;
        });

        const totalsTbody = document.querySelector('#totals-table tbody');

        for (const [port, total] of Object.entries(portTotals)) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${port}</td><td>${total}</td>`;
            totalsTbody.appendChild(tr);
        }

        document.getElementById('grand-total').innerText = grandTotal;
    });
    </script>

    <h3>Active Network Connections</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Local IP</th>
                <th>Local Port</th>
                <th>Remote IP</th>
                <th>Remote Port</th>
                <th>PID</th>
            </tr>
        </thead>
        <tbody>
            {% for conn in network_connections %}
            <tr>
                <td>{{ conn.local_ip }}</td>
                <td>{{ conn.local_port }}</td>
                <td>{{ conn.remote_ip }}</td>
                <td>{{ conn.remote_port }}</td>
                <td>{{ conn.pid }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
</div>
{% endblock %}